{% extends 'xadmin/base_site.html' %}

{% block content-nav %}
{% endblock %}

{% block content %} 
    <!-- <div class="row"> -->

        <!-- life time value section -->
        <div class="row" id="life-time-rectangle">
            <div class="detail-title-block" style="background-color: #ff6426;">
                <span class="detail-title">Life Time Value</span>
            </div>
            <div class="row" style="margin-top:15px;">
                <div class="col-md-6" >
                    <div class="col-md-3">
                        <div class="block-title"><span>&nbsp;</span></div>
                        <div class="block-title"><span>MEMBER LEVEL</span></div>
                        <div class="life-time-value-block">
                            <div class="block-content">
                                None
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="block-title"><span>&nbsp;</span></div>
                        <div class="block-title"><span>RISK LEVEL</span></div>
                        <div class="life-time-value-block">
                            <div class="block-content">
                                None
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="block-title"><span>WITHDRAWAL/</span></div>
                        <div class="block-title"><span>DEPOSIT</span></div>
                        <div class="life-time-value-block">
                            <div class="block-content">
                                {{ withdrawDepositRate }}%
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="block-title"><span>&nbsp;</span></div>
                        <div class="block-title"><span>BONUS/ DEPOSIT</span></div>
                        <div class="life-time-value-block">
                            <div class="block-content">
                                {{ bonusDepositRate }}%
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6" style="margin-top:12px;">
                    <div>
                        <div><span id="contribution-title">CONTRIBUTION PER PRODUCT</span></div>
                    </div>
                    <div>
                        <div class="pie-chart">
                        </div>
                    </div>
                    <div class="col-md-10">

                    </div>
                </div>


            </div>

            <div class="row" style="margin-top:15px;margin-left: 0px;">
                <div class="col-md-2">
                    <label>ACTIVE DAYS</label>
                    <div class="active-block">
                    </div>
                </div>
                <div class="col-md-2" style="padding: 0px;">
                    <label>DEPOSIT COUNT</label>
                    <div class="active-block">
                        <div class="account-detail">{{ depositCount }}</div>
                    </div>
                </div>
                <div class="col-md-2" style="padding: 0px; margin-left: -15px;">
                    <label>WITHDRAWAL COUNT</label>
                    <div class="active-block">
                        <div class="account-detail">{{ withdrawCount }}</div>
                    </div>
                </div>
                <div class="col-md-2" style="padding: 0px; margin-left: -15px;">
                    <label>LOGIN COUNT</label>
                    <div class="active-block">
                        <div class="account-detail" style="float:left;">{{ loginCount }}</div>
                        <button id="login-btn" type="button" class="btn btn-default" data-toggle="modal" data-target="#login_history"><i class="glyphicon glyphicon-search"></i></button>
                    </div>
                </div>
                <div class="col-md-2" style="padding: 0px; margin-left: -15px;">
                    <label>DEPOSTI AMOUNT</label>
                    <div class="active-block">
                        <div class="account-detail">${{ depositAmount }}</div>
                    </div>
                </div>
                <div class="col-md-2" style="padding: 0px; margin-left: -15px;">
                    <label>WITHDRAWAL AMOUNT</label>
                    <div class="active-block">
                        <div class="account-detail">${{ withdrawAmount }}</div>
                    </div>
                </div>
            </div>

        </div>

        <!-- memeber detail & activity section -->
        <div class="row" style="margin-top:20px; margin-left:3px;">
            <div class="member-detail-rectangle col-md-5">  
                <div class="half-title-block" style="background-color: #ffa313;">
                    <span class="detail-title">Member details</span>
                </div>
                <!-- <div class="section-body"> -->
                <div class="row" style="margin-top:20px; min-height: 380px;">
                    <div class='col-md-5' style="margin-left:20px; padding-bottom: 30px;">
                        <input type="hidden" id="hidden_user_id" value="{{ customuser.pk }}"></input>
                        <div class="row">
                            <div class="col-md-6">
                                <span class="memeber-detail-label">Member ID</span>
                            </div>
                            <div class="col-md-6" style="margin-left:-40px;">
                                <span class="detail-info">{{ customuser.pk }}</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <span class="memeber-detail-label">Username</span>
                            </div>
                            <div class="col-md-6" style="margin-left:-40px;">
                                <span class="detail-info">{{ customuser.username }}</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <span class="memeber-detail-label">Is affilate</span>
                            </div>
                            <div class="col-md-6" style="margin-left:-40px;">
                                <span class="detail-info"><a href="#">Yes</a></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <span class="memeber-detail-label">First Name</span>
                            </div>
                            <div class="col-md-6" style="margin-left:-40px;">
                                <span class="detail-info">{{ customuser.first_name }}</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <span class="memeber-detail-label">Last Name</span>
                            </div>
                            <div class="col-md-6" style="margin-left:-40px;">
                                <span class="detail-info">{{ customuser.last_name }}</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <span class="memeber-detail-label">Email</span>
                            </div>
                            <div class="col-md-6" style="margin-left:-40px;">
                                <span class="detail-info">{{ customuser.email }}</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <span class="memeber-detail-label">Phone</span>
                            </div>
                            <div class="col-md-6" style="margin-left:-40px;">
                                <span class="detail-info">{{ customuser.phone }}</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <span class="memeber-detail-label">Birthday</span>
                            </div>
                            <div class="col-md-6" style="margin-left:-40px;">
                                <span class="detail-info">{{ customuser.date_of_birth }}</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <span class="memeber-detail-label">Address</span>
                            </div>
                            <div class="col-md-6" style="margin-left:-40px;">
                                <div><span class="detail-info">{{ customuser.street_address_1 }}</span></div>
                                <div><span class="detail-info">{{ customuser.street_address_2 }}</span></div>
                                <div><span class="detail-info">{{ customuser.city }}</span></div>
                                <div><span class="detail-info">{{ customuser.zipcode }}</span></div>
                                <div><span class="detail-info">{{ customuser.country }}</span></div>
                            </div>
                        </div>
                    </div>
                    <div class='col-md-5' style="margin-left:30px">
                        {% if userPhotoId %}
                        <img id="user-photo-id" src="{{ userPhotoId }}">
                        {% else %}
                        <!-- <div id="user-photo-id">None</div> -->
                        <img id="user-photo-id" src="https://www.imagemet.com/wp-content/uploads/2016/12/placeholder.png" alt="User ID Photo">
                        {% endif %}
                        <button id="zoom-btn" class="zoom-btn btn-lg" data-toggle="modal" data-target="#myModal"><i class="fas fa-search-plus"></i></button>
                    </div>
                    <!-- </div> -->
                    <div id="myModal" class="modal fade" role="dialog" style="width:600px;">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <h4 class="modal-title">USER PHOTO ID</h4>
                                </div>
                                <div class="modal-body">
                                    <img class="showimage img-responsive" src="" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                        <hr>
                </div>
                <div class="row">
                    <!-- <div class='col-md-6'> -->
                        <div class="user-detail-subtitle">LAST ACTIVITY</div>
                        <div class="col-md-4" style="margin-left: 15px;margin-right: -20px;">
                            <div class="user-detail-content-title">LOGIN</div>
                            <div class="user-info-block">
                                <div id="member-input-container">
                                    <div>
                                        <div class="block-title">Time</div>
                                        {% if customuser.last_login_time %}
                                            <div class="block-text">{{ customuser.last_login_time }}</div>
                                        {% else %}
                                            <div class="block-text">None</div>
                                        {% endif %}
                                    </div>
                                    <div style="margin-top:12px;">
                                        <div class="block-title">Location</div>
                                        {% if customuser.id_location %}
                                            <div class="block-text">{{ customuser.id_location }}</div>
                                        {% else %}
                                            <div class="block-text">None</div>
                                        {% endif %}
                                    </div>
                                    <div style="margin-top:12px;">
                                        <div class="block-title">IP address</div>
                                        {% if userLastIpAddr.ip_addr %}
                                            <div class="block-text">{{ userLastIpAddr.ip_addr }}</div>
                                        {% else %}
                                            <div class="block-text">None</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <button class="popup-btn" data-toggle="modal" data-target="#login_history"><i class="glyphicon glyphicon-search"></i></button>
                            </div>
                        </div>
                        <div class="col-md-4" style="margin-right: -19px;">
                            <div class="user-detail-content-title">DEPOSIT</div>
                            <div class="user-info-block">
                                <div id="member-input-container">
                                    <div>
                                        <div class="block-title">Time</div>
                                        {% if lastDeposit.time %}
                                            <div class="block-text">{{ lastDeposit.time }}</div>
                                        {% else %}
                                            <div class="block-text">None</div>
                                        {% endif %}
                                    </div>
                                    <div style="margin-top:12px;">
                                        <div class="block-title">Amount</div>
                                        {% if lastDeposit.amount %}
                                            <div class="block-text">{{ lastDeposit.amount }}</div>
                                        {% else %}
                                            <div class="block-text">None</div>
                                        {% endif %}
                                    </div>
                                    <div style="margin-top:12px;">
                                        <div class="block-title">Status</div>
                                        {% if lastDeposit.status %}
                                            <div class="block-text">{{ lastDeposit.status }}</div>
                                        {% else %}
                                            <div class="block-text">None</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <button class="popup-btn" onclick='showInitialTransaction("{{ customuser.username }}", "{{ lastDeposit }}", "deposit")' data-toggle="modal" data-target="#trans_deposit_detail"><i class="glyphicon glyphicon-search"></i></button>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="user-detail-content-title">WITHDRAWAL</div>
                            <div class="user-info-block">
                                <div id="member-input-container">
                                    <div>
                                        <div class="block-title">Time</div>
                                        {% if lastWithdraw.time %}
                                            <div class="block-text">{{ lastWithdraw.time }}</div>
                                        {% else %}
                                            <div class="block-text">None</div>
                                        {% endif %}
                                    </div>
                                    <div style="margin-top:12px;">
                                        <div class="block-title">Amount</div>
                                        {% if lastWithdraw.amount %}
                                            <div class="block-text">{{ lastWithdraw.amount }}</div>
                                        {% else %}
                                            <div class="block-text">None</div>
                                        {% endif %}
                                    </div>
                                    <div style="margin-top:12px;">
                                        <div class="block-title">Status</div>
                                        {% if lastWithdraw.status %}
                                            <div class="block-text">{{ lastWithdraw.status }}</div>
                                        {% else %}
                                            <div class="block-text">None</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <button class="popup-btn" data-toggle="modal" data-target="#trans_withdrawal_detail"><i class="glyphicon glyphicon-search"></i></button>
                            </div>
                        </div>                       
                        <!-- </div> -->
                </div>
                <div class="row">
                    <hr>
                </div>
                <div class="row">
                    <div class="user-detail-subtitle">ACCOUNT CREATION</div>
                    <div id="account-creation-rect">
                        <div class="col-md-4">
                            <div style="margin-top:28px;">
                                <div class="block-title">Time</div>
                                <div class="block-text">{{ customuser.time_of_registration }}</div>
                            </div>
                            <div style="margin-top:28px;">
                                <div class="block-title">Verification time</div>
                                <div class="block-text">{{ customuser.verfication_time }}</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div style="margin-top:28px;">
                                <div class="block-title">Location</div>
                                {% if customuser.id_location %}
                                    <div class="block-text">{{ customuser.id_location }}</div>
                                {% else %}
                                    <div class="block-text">None</div>
                                {% endif %}
                            </div>
                            <div style="margin-top:28px;">
                                <div class="block-title">First deposit</div>
                                <div class="block-text">{{ customuser.ftd_time }}</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div style="margin-top:28px;">
                                <div class="block-title">Source</div>
                                <div class="block-text">{{ customuser.get_user_attribute_display }}</div>
                            </div>
                        </div>
                    </div>
                </div>
                        
                <div class='row'>
                    <button id="edit-detail-btn" type="button" class="btn btn-primary" data-toggle="modal" data-target="#edit_details">Edit details</button>
                </div>
        
                <div class="modal fade" id="edit_details" role="dialog">
                    <div class="modal-dialog">
                    
                        <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Edit member details</h4>
                                <!-- <h6 style="float: right;">Update Time:</h6> -->
                            </div>
                            <div class="modal-body">
                                <div class='row'>
                                    <form action="{% url 'xadmin:user_detail' %}" method="POST">
                                        {% csrf_token %}
                                        <div class='col-md-6'>
                                            <input type="hidden" name="type" value="edit_user_detail"></input>
                                            <input type="hidden" name="user_id" value="{{ customuser.pk }}"></input>
                                            <div class="form-group">
                                                <label for="member_id">MEMBER ID</label>
                                                <input class="form-control" id='member_id' name="member_id" value="{{ customuser.pk }}">
                                            </div>
                                            <div class="form-group">
                                                <label for="username">USERNAME</label>
                                                <input class="form-control" id='username' name="username" value="{{ customuser.username }}">
                                            </div>
                                            <div class="form-group">
                                                <label for="first_name">FIRST NAME</label>
                                                <input class="form-control" name="first_name" value="{{ customuser.first_name }}">
                                            </div>
                                            <div class="form-group">
                                                <label for="last_name">LAST NAME</label>
                                                <input class="form-control" name="last_name" value="{{ customuser.last_name }}">
                                            </div>
                                            <div class="form-group">
                                                <label for="email">EMAIL</label>
                                                <input type='email' id='email' class="form-control" name="email" value="{{ customuser.email }}">
                                            </div>
                                            <div class="form-group">
                                                <label for="phone">PHONE</label>
                                                <input class="form-control" id='phone' name="phone" value="{{ customuser.phone }}">
                                            </div>
                                            <div class="form-group">
                                                <label for="birthday">BIRTHDAY</label>
                                                <input class="form-control" name="birthday" value="{{ customuser.date_of_birth }}">
                                            </div>
                                            <div class="form-group">
                                                <label for="address">ADDRESS</label>
                                                <input class="form-control" name="address" value="{{ customuser.street_address_1 }}">
                                                <input class="form-control" name="city" value="{{ customuser.city }}">
                                                <input class="form-control" name="zipcode" value="{{ customuser.zipcode }}">
                                                <input class="form-control" name="country" value="{{ customuser.country }}">
                                            </div>
                                            <div>&nbsp;</div>
                                            <p id='errorMessage'>&nbsp;</p>
                                            <button type="submit" id="submitButton" class="btn btn-primary">Submit</button>
                                            <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                                        </div>
                                        <div class="col-md-6">
                                            <input id='hidden_input_img' type='file' accept='image/*' style='display: none;' onchange="chooseFile(event);">
                                            {% if userPhotoId %}
                                            <img id="user-photo-img" src="{{ userPhotoId }}">
                                            {% else %}
                                            <img id="user-photo-img" src="https://www.imagemet.com/wp-content/uploads/2016/12/placeholder.png" alt="User ID Photo">
                                            {% endif %}
                                            <input type="hidden" name='user_id_img' id="hidden_user_id_url">
                                            <div>&nbsp;</div>
                                            <div class="row">
                                                <div class='col-md-8'>
                                                    <button type="button" class="btn btn-primary" onclick="clickUploadImg();">Upload new document</button>
                                                </div>
                                                <div class='col-md-4'>
                                                    <button type="button" class="btn btn-default" style="background-color:rgb(199, 89, 82)" onclick="clearImg();">
                                                        <span class="glyphicon glyphicon-trash" style='color:white'></span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <!-- <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div> -->
                        </div>
                        
                    </div>
                </div>
    
                <div class="modal fade" id="login_history" role="dialog">
                        <div class="modal-dialog">
                        
                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <h4 class="modal-title">Login history</h4>
                                </div>
                                <div class="modal-body">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                            <th scope="col">Time</th>
                                            <th scope="col">Location</th>
                                            <th scope="col">IP address</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for login in userLoginActions %}
                                            <tr>
                                            <td>{{ login.created_time }}</td>
                                            <td>Location</td>
                                            <td>{{ login.ip_addr }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <!-- <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                </div> -->
                            </div> 
                        </div>
                </div>
                </div>
            <div class="activity-rectangle col-md-5">  
                <div class="half-title-block" style="background-color: #588ebd;">
                    <span class="detail-title">Activity</span>
                </div>
                <div class="form-group" style="padding:20px 0px 20px 0px; margin-left:25px;">
                    <div><span class="block-title">ACTIVITY TYPE</span></div>
                    <div style="width:165px;"><select class="form-control" id="activity-select">
                            <option value="all">All activity</option>
                            <option value="0">Operation</option>
                            <option value="1">Remark</option>
                            <option value="2">Chat</option>
                            <option value="3">Note</option>
                        </select>
                    </div>
                </div>
                <div id="select-filter" style="border-top: 1px solid; overflow-y: auto; height:807px;">
                    {% for act in activity %}
                        <div class="note-author">{{ act.admin }}</div>
                        <div class="note-block">{{ act.message }}</div>
                    {% endfor %}
                    <!-- <div class="note-author">Martin Sandstrom</div>
                    <div class="note-block">note</div>
                    <div class="note-author">Martin Sandstrom</div>
                    <div class="note-block">note</div>
                    <div class="note-author">Martin Sandstrom</div>
                    <div class="note-block">note</div>
                    <div class="note-author">Martin Sandstrom</div>
                    <div class="note-block">note</div>
                    <div class="note-author">Martin Sandstrom</div>
                    <div class="note-block">note</div>
                    <div class="note-author">Martin Sandstrom</div>
                    <div class="note-block">note</div>
                    <div class="note-author">Martin Sandstrom</div>
                    <div class="note-block">note</div>
                    <div class="note-author">Martin Sandstrom</div>
                    <div class="note-block">note</div> -->
                </div>
                <div id="note-input-container">
                    <button id="note-btn"><i class="fa fa-paperclip" aria-hidden="true"></i></button>
                    <input type="text" class="form-control" id="notes-input" placeholder="Write a new note...">
                    <button class="btn btn-primary" id="post-btn">Post</button>
                </div>
            </div>
        </div>

        <!-- fund status section -->
        <div class="row" id="fund-rectangle">
            <div class="detail-title-block" style="background-color: #00a281;">
                <span class="detail-title">Fund status</span>
            </div>
            <div class="row" style="margin-top:20px;">
                <div class="col-md-6" >
                    <div class="col-md-3">
                        <div class="block-title"><span>MAIN</span></div>
                        <div class="block-title"><span>WALLET BALANCE</span></div>
                        <div class="fund-block">
                            <div class="status-block-content">
                                ${{ customuser.main_wallet }}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="block-title"><span>AVAILAVLE FOR</span></div>
                        <div class="block-title"><span>WITHDRAWAL</span></div>
                        <div class="fund-block">
                            <div class="status-block-content">
                                ${{ customuser.main_wallet }}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="block-title"><span>MIN/ MAX</span></div>
                        <div class="block-title"><span>WITHDRAW AMOUNT</span></div>
                        <div class="fund-block">
                            <div class="status-block-content">
                                NO LIMIT
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="block-title"><span>&nbsp;</span></div>
                        <div class="block-title"><span>BONUS AMOUNT</span></div>
                        <div class="fund-block">
                            <div class="status-block-content">
                                None
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6" style="margin-top:12px;">
                    <div>
                        <div><span id="balance-wallet-title">BANANCE PER WALLET</span></div>
                    </div>
                    <div>
                        <div class="pie-chart">
                        </div>
                    </div>
                    <div class="col-md-10">

                    </div>
                </div>


            </div>

            <div style="margin-top:35px;margin-left: 15px;">
                <button class="btn btn-primary"><span>Make adjustment</span></button>
                <button class="btn btn-primary"><span>Transfer in/ out</span></button>
                <button  class="btn btn-primary"><span>Release bonus</span></button>
            </div>
        </div>

        <!-- transaction section -->
        <div class="row" id="transaction-rectangle">
            <div class="detail-title-block" style="background-color: #489e24;">
                <span class="detail-title">Transaction History</span>
            </div>
            <div class="row" style="margin-top:20px;">
                <div class="col-md-6" >
                    <div class='col-md-8'>
                        <div class="row">
                            <div class='col-md-6'>
                                <div class="block-title">PRODUCT</div>
                                <select class="form-control" id="transaction_product_select">
                                    <option value="all">All products</option>
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                </select>
                            </div>
                            <div class='col-md-6'>
                                <div class="block-title">CATEGORY</div>
                                <select class="form-control" id="transaction_category_select">
                                    <option value="all">All transactions</option>
                                    <option value="0">Deposit</option>
                                    <option value="1">Withdraw</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-5" style="margin-right: -112px; float: right;">
                    <div class="block-title">DATE RANGE</div>
                    <div class="row">
                        <div class='col-md-4' style="padding-right: 0px;">
                            <div class='input-group date' id='transaction_time_from'>
                                <input type='text' class="form-control" placeholder="From" id='transaction_time_from_input' />
                                <span class="input-group-addon">
                                    <span class="glyphicon glyphicon-calendar"></span>
                                </span>
                            </div>
                        </div>
                        <div class='col-md-4'>
                            <div class='input-group date' id='transaction_time_to'>
                                <input type='text' class="form-control" placeholder="To"  id='transaction_time_to_input'/>
                                <span class="input-group-addon">
                                    <span class="glyphicon glyphicon-calendar"></span>
                                </span>
                            </div>
                        </div>
                        <div class='col-md-2' style="padding-left: 0px;">
                            <button id="transaction_time_submit" type="submit" class="btn btn-primary"><span class="glyphicon glyphicon-search"></span></button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- <label style="margin:15px">TRNASACTION LAST 7 DAYS</label> -->
            <div class="row" style="margin:20px 15px 15px 15px">
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">CATEGORY</th>
                            <th scope="col">TRANSACTION TYPE</th>
                            <th scope="col">PRODUCT</th>
                            <th scope="col">TRANSACTION NO.</th>
                            <th scope="col">WALLET</th>
                            <th scope="col">CURRENCY</th>
                            <th scope="col">TIME</th>
                            <th scope="col">AMOUNT</th>
                            <th scope="col">BALANCE</th>
                            <th scope="col">STATUS</th>
                            <th scope="col"></th>
                        </tr>
                    </thead>
                    <tbody id="transaction_tbody">
                        {% for trans in userTransactions %} 
                        <tr>
                            <td scope="row">{{ forloop.counter }}</td>
                            <td>{{ trans.category }}</td>
                            <td>{{ trans.transType }}</td>
                            <td>{{ trans.product }}</td>
                            <td>{{ trans.transactionId }}</td>
                            {% if trans.transfer_to %}
                                <td>{{ trans.transfer_to }}</td>
                            {% else %}
                                <td>None</td>
                            {% endif %}
                            <td>{{ trans.currency }}</td>
                            <td id="requestTime">{{ trans.time }}</td>
                            <td>{{ trans.amount }}</td>
                            <td>{{ trans.amount }}</td>
                            <td>{{ trans.status }}</td>
                            {% if trans.transTypeCode == 0 %}
                            <td><button type="button" class="btn btn-primary" onclick='showInitialTransaction("{{ customuser.username }}", "{{ trans }}", "deposit")' data-toggle="modal" data-target="#trans_deposit_detail"><span class="glyphicon glyphicon-search"></span></button></td>
                            {% elif trans.transTypeCode == 1 %}
                            <td><button type="button" class="btn btn-primary" onclick='showInitialTransaction("{{ customuser.username }}", "{{ trans }}", "withdraw")' data-toggle="modal" data-target="#trans_withdrawal_detail"><span class="glyphicon glyphicon-search"></span></button></td>
                            {% elif trans.transTypeCode == 2 %}
                            <td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#trans_bet_placed_detail"><span class="glyphicon glyphicon-search"></span></button></td>
                            {% elif trans.transTypeCode == 3 %}
                            <td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#trans_bet_settled_detail"><span class="glyphicon glyphicon-search"></span></button></td>
                            {% elif trans.transTypeCode == 4 %}
                            <td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#trans_trans_in_detail"><span class="glyphicon glyphicon-search"></span></button></td>
                            {% elif trans.transTypeCode == 5 %}
                            <td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#trans_trans_out_detail"><span class="glyphicon glyphicon-search"></span></button></td>
                            {% elif trans.transTypeCode == 6 %}
                            <td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#trans_bonus_detail"><span class="glyphicon glyphicon-search"></span></button></td>
                            {% elif trans.transTypeCode == 7 %}
                            <td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#trans_adjustment_detail"><span class="glyphicon glyphicon-search"></span></button></td>
                            {% endif %}
                        </tr>
                        <div class="modal fade" id="trans_deposit_detail" role="dialog">
                            <div class="modal-dialog">
                                <!-- Modal content-->
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        <h4 class="modal-title">Deposit Detail</h4>
                                    </div>
                                    <div class="modal-body">
                                        <div class="row">
                                            <div class="col-md-5">
                                                <p>Client Name </p>
                                                <p>Transaction Number </p>
                                                <p>Time of application </p>
                                                <p>Account Time </p>
                                                <p>Approver </p>
                                                <p>Bank/Branch </p>
                                                <p>Receive Bank </p>
                                                <p>Apply amount </p>
                                                <p>Arrive amount </p>
                                                <p>Status </p>
                                            </div>
                                            <div class="col-md-7" id="deposit-detail">
                                                <p>{{ customuser.username }}</p>
                                                <p>{{ trans.transactionId }}</p>
                                                <p>{{ trans.time }}</p>
                                                <p>{{ trans.time }}</p>
                                                <p>/</p>
                                                <p>{{ trans.channel }} </p><p>{{ trans.method }}</p>
                                                <p>/</p>
                                                <p>{{ trans.amount }}</p>
                                                <p>{{ trans.amount }}</p>
                                                <p>{{ trans.status }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div> 
                            </div>
                        </div>
                        <div class="modal fade" id="trans_withdrawal_detail" role="dialog">
                            <div class="modal-dialog">
                                <!-- Modal content-->
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        <h4 class="modal-title">Withdrawal Detail</h4>
                                    </div>
                                    <div class="modal-body">
                                        <div class="row">
                                            <div class="col-md-5">
                                                <p>Client Name </p>
                                                <p>Transaction Number </p>
                                                <p>Time of application </p>
                                                <p>Account Time </p>
                                                <p>Bank/Branch </p>
                                                <p>Receive Bank </p>
                                                <p>Assignment error</p>
                                                <p>Bank Account</p>
                                                <p>Channel Name</p>
                                                <p>Apply amount </p>
                                                <p>Arrive amount </p>
                                                <p>Surcharge </p>
                                                <p>Time of Audit </p>
                                                <p>Auditor </p>
                                                <p>Audi Memo </p>
                                                <p>Status </p>
                                            </div>
                                            <div class="col-md-7" id="withdraw-detail">
                                                <p>{{ customuser.username }}</p>
                                                <p>{{ trans.transactionId }}</p>
                                                <p>{{ trans.time }}</p>
                                                <p>{{ trans.time }}</p>
                                                <p>{{ trans.channel }} </p><p>{{ trans.method }}</p>
                                                <p>/</p>
                                                <p>/</p>
                                                <p>/</p>
                                                <p>{{ trans.channel }} </p>
                                                <p>{{ trans.amount }}</p>
                                                <p>{{ trans.amount }}</p>
                                                <p>fee</p>
                                                <p>/</p>
                                                <p>/</p>
                                                <p>/</p>
                                                <p>{{ trans.status }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div> 
                            </div>
                        </div>
                        <div class="modal fade" id="trans_bet_placed_detail" role="dialog">
                                <div class="modal-dialog">
                                    <!-- Modal content-->
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                                            <h4 class="modal-title">Deposit Detail</h4>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <p>Client Name </p>
                                                    <p>Transaction Number </p>
                                                    <p>Time of application </p>
                                                    <p>Account Time </p>
                                                    <p>Approver </p>
                                                    <p>Bank/Branch </p>
                                                    <p>Receive Bank </p>
                                                    <p>Apply amount </p>
                                                    <p>Arrive amount </p>
                                                    <p>Status </p>
                                                </div>
                                                <div class="col-md-6">
                                                    <p>{{ customuser.username }}</p>
                                                    <p>{{ trans.transactionId }}</p>
                                                    <p>{{ trans.time }}</p>
                                                    <p>{{ trans.time }}</p>
                                                    <p></p>
                                                    <p>{{ trans.channel }} </p><p>{{ trans.method }}</p>
                                                    <p>/</p>
                                                    <p>{{ trans.amount }}</p>
                                                    <p>{{ trans.amount }}</p>
                                                    <p>{{ trans.status }}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div> 
                                </div>
                        </div>
                        <div class="modal fade" id="trans_bet_settled_detail" role="dialog">
                                <div class="modal-dialog">
                                    <!-- Modal content-->
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                                            <h4 class="modal-title">Deposit Detail</h4>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <p>Client Name </p>
                                                    <p>Transaction Number </p>
                                                    <p>Time of application </p>
                                                    <p>Account Time </p>
                                                    <p>Approver </p>
                                                    <p>Bank/Branch </p>
                                                    <p>Receive Bank </p>
                                                    <p>Apply amount </p>
                                                    <p>Arrive amount </p>
                                                    <p>Status </p>
                                                </div>
                                                <div class="col-md-6">
                                                    <p>{{ customuser.username }}</p>
                                                    <p>{{ trans.transactionId }}</p>
                                                    <p>{{ trans.time }}</p>
                                                    <p>{{ trans.time }}</p>
                                                    <p></p>
                                                    <p>{{ trans.channel }} </p><p>{{ trans.method }}</p>
                                                    <p>/</p>
                                                    <p>{{ trans.amount }}</p>
                                                    <p>{{ trans.amount }}</p>
                                                    <p>{{ trans.status }}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div> 
                                </div>
                        </div>
                        {% endfor %}
                    </tbody>
                </table>
                <div class="row">
                    <div class='col-md-1'>
                        <button class="btn btn-primary"><span>Export</span></button>
                    </div>
                    <div class="transaction-control-group col-md-9"></div>
                    <div>
                        <div class='col-md-1'>
                        <!-- <div class='col-md-1'> -->
                            <input type="hidden" id="hidden_row" value="0"></input>
                            <select id="pagination_value"  class="form-control">
                                <option value="20">20</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                                <option value="250">250</option>
                            </select>
                        </div>
                        <div class='col-md-1'>
                            <ul class="pagination" style="margin:0px;">
                                <li class="page-item disabled" id='previousPage'>
                                <a class="page-link" href="javascript:getPrevious();" tabindex="-1"><i class='fas fa-caret-left'></i></a>
                                </li>
                                {% if isLastPage is True %}
                                <li class="page-item disabled" id='nextPage'><a class="page-link" href="javascript:getNext();"><i class='fas fa-caret-right'></i></a></li>
                                {% else %}
                                <li class="page-item" id='nextPage'><a class="page-link" href="javascript:getNext();"><i class='fas fa-caret-right'></i></a></li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- risk control section -->
        <div class="row" id="risk-control-rectangle">
            <div class="detail-title-block" style="background-color: #9aa0d0;">
                <span class="detail-title">Risk control</span>
            </div>
            <div class="container nav-bar">
                <ul class="nav nav-tabs ">
                    <li class="active"><a data-toggle="tab" href="#related-account">RELATED ACCOUNTS</a></li>
                    <li><a data-toggle="tab" href="#related-device">RELATED DEVICE</a></li>
                    <li><a data-toggle="tab" href="#deposit-withdraw">DEPOSIT / WITHDRAWAL</a></li>
                    <li><a data-toggle="tab" href="#winloss-bonus">WINLOSS / BONUS</a></li>
                </ul>
                <div class="tab-content">
                    <div id="related-account" class="tab-pane fade in active">
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                <th scope="col">#</th>
                                <th scope="col">MEMBER</th>
                                <th scope="col">CHANNEL</th>
                                <th scope="col">SOURCE</th>
                                <th scope="col">DEPOSIT</th>
                                <th scope="col">BONUS / TURNOVER</th>
                                <th scope="col">WITHDRAWAL</th>
                                <th scope="col">CONTRIBUTION</th>
                                <th scope="col">RISK LEVEL</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if relativeAccount%}
                                    {% for account in relativeAccount %}
                                    <tr>
                                        <td scope="row">{{ forloop.counter }}</td>
                                        <td><a href="{% url 'xadmin:user_detail' account.id %}">{{ account.username }}</td>
                                        <td>{{ account.source }}</td>
                                        <td>{{ account.channel }}</td>
                                        <td>{{ account.deposit }}</td>
                                        <td>{{ account.turnover }}</td>
                                        <td>{{ account.withdrawal }}</td>
                                        <td>{{ account.contribution }}</td>
                                        <td>{{ account.riskLevel }}</td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                {% endif %}
                            </tbody>
                        </table>
                        <div class="row">
                            <div class='col-md-1'>
                                <button class="btn btn-primary"><span>Export</span></button>
                            </div>
                            <div class="transaction-control-group col-md-9"></div>
                            <div>
                                <div class='col-md-1'>
                                <!-- <div class='col-md-1'> -->
                                    <input type="hidden" id="hidden_row" value="0"></input>
                                    <select id="pagination_value"  class="form-control">
                                        <option value="20">20</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                        <option value="250">250</option>
                                    </select>
                                </div>
                                <div class='col-md-1'>
                                    <ul class="pagination" style="margin:0px;">
                                        <li class="page-item disabled" id='previousPage'>
                                        <a class="page-link" href="javascript:getPrevious();" tabindex="-1"><i class='fas fa-caret-left'></i></a>
                                        </li>
                                        {% if isLastPage is True %}
                                        <li class="page-item disabled" id='nextPage'><a class="page-link" href="javascript:getNext();"><i class='fas fa-caret-right'></i></a></li>
                                        {% else %}
                                        <li class="page-item" id='nextPage'><a class="page-link" href="javascript:getNext();"><i class='fas fa-caret-right'></i></a></li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="related-device" class="tab-pane fade">
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                <th scope="col">#</th>
                                <th scope="col">Device Number</th>
                                <th scope="col">Location</th>
                                <th scope="col">Count</th>
                                <th scope="col">Percentage</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- {% for account in relativeAccount %} -->
                                <tr>
                                    <td scope="row">{{ forloop.counter }}</td>
                                    <td>test data</td>
                                    <td>test data</td>
                                    <td>test data</td>
                                    <td>test data</td>
                                </tr>
                                <!-- {% endfor %} -->
                            </tbody>
                        </table>
                        <div class="row">
                            <div class='col-md-1'>
                                <button class="btn btn-primary"><span>Export</span></button>
                            </div>
                            <div class="transaction-control-group col-md-9"></div>
                            <div>
                                <div class='col-md-1'>
                                <!-- <div class='col-md-1'> -->
                                    <input type="hidden" id="hidden_row" value="0"></input>
                                    <select id="pagination_value"  class="form-control">
                                        <option value="20">20</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                        <option value="250">250</option>
                                    </select>
                                </div>
                                <div class='col-md-1'>
                                    <ul class="pagination" style="margin:0px;">
                                        <li class="page-item disabled" id='previousPage'>
                                        <a class="page-link" href="javascript:getPrevious();" tabindex="-1"><i class='fas fa-caret-left'></i></a>
                                        </li>
                                        {% if isLastPage is True %}
                                        <li class="page-item disabled" id='nextPage'><a class="page-link" href="javascript:getNext();"><i class='fas fa-caret-right'></i></a></li>
                                        {% else %}
                                        <li class="page-item" id='nextPage'><a class="page-link" href="javascript:getNext();"><i class='fas fa-caret-right'></i></a></li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="deposit-withdraw" class="tab-pane fade">
                        <canvas id="deposit-withdraw-chart"></canvas>
                    </div>
                    <div id="winloss-bonus" class="tab-pane fade">
                        <canvas id="winloss-bonus"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- bonus section -->

        <div class="row" id="bonus-control-rectangle">
            <div class="detail-title-block" style="background-color: #e26a6b;">
                <span class="detail-title">Bonus history</span>
            </div>
            <div class="container nav-bar">
                <ul class="nav nav-tabs ">
                    <li class="active"><a data-toggle="tab" href="#bonus-active">ACTIVE</a></li>
                    <li><a data-toggle="tab" href="#bonus-complete">COMPLETED</a></li>
                    <li><a data-toggle="tab" href="#bonus-cancelled">CANCELLED</a></li>
                </ul>
                <div class="tab-content">
                    <div id="bonus-active" class="tab-pane fade in active">
                        <div class="row" style="margin-top:30px;">
                            <div class="col-md-2">
                                <div class="block-title">BONUS TYPE</div>
                                <select class="form-control" id="transaction_product_select">
                                    <option value="all">All bonuses</option>
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                </select>
                            </div>
                        </div>
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                <th scope="col">#</th>
                                <th scope="col">BONUS NAME</th>
                                <th scope="col">BONUS TYPE</th>
                                <th scope="col">TIME OF APPLICATION</th>
                                <th scope="col">TIME RECEIVED</th>
                                <th scope="col">AMOUNT</th>
                                <th scope="col">WITHDRAW LIMITATION</th>
                                <th scope="col">COMPLETION</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if relativeAccount%}
                                    {% for account in relativeAccount %}
                                    <tr>
                                        <td scope="row">{{ forloop.counter }}</td>
                                        <td><a href="{% url 'xadmin:user_detail' account.id %}">{{ account.username }}</td>
                                        <td>{{ account.source }}</td>
                                        <td>{{ account.channel }}</td>
                                        <td>{{ account.deposit }}</td>
                                        <td>{{ account.turnover }}</td>
                                        <td>{{ account.withdrawal }}</td>
                                        <td>{{ account.contribution }}</td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                {% endif %}
                            </tbody>
                        </table>
                        <div class="row">
                            <div class='col-md-1'>
                                <button class="btn btn-primary"><span>Export</span></button>
                            </div>
                            <div class="transaction-control-group col-md-9"></div>
                            <div>
                                <div class='col-md-1'>
                                <!-- <div class='col-md-1'> -->
                                    <input type="hidden" id="hidden_row" value="0"></input>
                                    <select id="pagination_value"  class="form-control">
                                        <option value="20">20</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                        <option value="250">250</option>
                                    </select>
                                </div>
                                <div class='col-md-1'>
                                    <ul class="pagination" style="margin:0px;">
                                        <li class="page-item disabled" id='previousPage'>
                                        <a class="page-link" href="javascript:getPrevious();" tabindex="-1"><i class='fas fa-caret-left'></i></a>
                                        </li>
                                        {% if isLastPage is True %}
                                        <li class="page-item disabled" id='nextPage'><a class="page-link" href="javascript:getNext();"><i class='fas fa-caret-right'></i></a></li>
                                        {% else %}
                                        <li class="page-item" id='nextPage'><a class="page-link" href="javascript:getNext();"><i class='fas fa-caret-right'></i></a></li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="bonus-complete" class="tab-pane fade">
                        <div class="row" style="margin-top:30px;">
                            <div class="col-md-2">
                                <div class="block-title">BONUS TYPE</div>
                                <select class="form-control" id="transaction_product_select">
                                    <option value="all">All bonuses</option>
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                </select>
                            </div>
                        </div>
                        <table class="table table-striped table-bordered">
                            <thead>
                                    <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">BONUS NAME</th>
                                    <th scope="col">BONUS TYPE</th>
                                    <th scope="col">TIME OF APPLICATION</th>
                                    <th scope="col">TIME RECEIVED</th>
                                    <th scope="col">AMOUNT</th>
                                    <th scope="col">WITHDRAW LIMITATION</th>
                                    <th scope="col">COMPLETION</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if relativeAccount%}
                                        {% for account in relativeAccount %}
                                        <tr>
                                            <td scope="row">{{ forloop.counter }}</td>
                                            <td><a href="{% url 'xadmin:user_detail' account.id %}">{{ account.username }}</td>
                                            <td>{{ account.source }}</td>
                                            <td>{{ account.channel }}</td>
                                            <td>{{ account.deposit }}</td>
                                            <td>{{ account.turnover }}</td>
                                            <td>{{ account.withdrawal }}</td>
                                            <td>{{ account.contribution }}</td>
                                        </tr>
                                        {% endfor %}
                                    {% else %}
                                    {% endif %}
                                </tbody>
                            </thead>
                        </table>
                        <div class="row">
                            <div class='col-md-1'>
                                <button class="btn btn-primary"><span>Export</span></button>
                            </div>
                            <div class="transaction-control-group col-md-9"></div>
                            <div>
                                <div class='col-md-1'>
                                <!-- <div class='col-md-1'> -->
                                    <input type="hidden" id="hidden_row" value="0"></input>
                                    <select id="pagination_value"  class="form-control">
                                        <option value="20">20</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                        <option value="250">250</option>
                                    </select>
                                </div>
                                <div class='col-md-1'>
                                    <ul class="pagination" style="margin:0px;">
                                        <li class="page-item disabled" id='previousPage'>
                                        <a class="page-link" href="javascript:getPrevious();" tabindex="-1"><i class='fas fa-caret-left'></i></a>
                                        </li>
                                        {% if isLastPage is True %}
                                        <li class="page-item disabled" id='nextPage'><a class="page-link" href="javascript:getNext();"><i class='fas fa-caret-right'></i></a></li>
                                        {% else %}
                                        <li class="page-item" id='nextPage'><a class="page-link" href="javascript:getNext();"><i class='fas fa-caret-right'></i></a></li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="bonus-cancelled" class="tab-pane fade">
                        <div class="row" style="margin-top:30px;">
                            <div class="col-md-2">
                                <div class="block-title">BONUS TYPE</div>
                                <select class="form-control" id="transaction_product_select">
                                    <option value="all">All bonuses</option>
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                </select>
                            </div>
                        </div>
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                <th scope="col">#</th>
                                <th scope="col">BONUS NAME</th>
                                <th scope="col">BONUS TYPE</th>
                                <th scope="col">TIME OF APPLICATION</th>
                                <th scope="col">TIME RECEIVED</th>
                                <th scope="col">AMOUNT</th>
                                <th scope="col">WITHDRAW LIMITATION</th>
                                <th scope="col">COMPLETION</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% if relativeAccount%}
                                    {% for account in relativeAccount %}
                                    <tr>
                                        <td scope="row">{{ forloop.counter }}</td>
                                        <td><a href="{% url 'xadmin:user_detail' account.id %}">{{ account.username }}</td>
                                        <td>{{ account.source }}</td>
                                        <td>{{ account.channel }}</td>
                                        <td>{{ account.deposit }}</td>
                                        <td>{{ account.turnover }}</td>
                                        <td>{{ account.withdrawal }}</td>
                                        <td>{{ account.contribution }}</td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                {% endif %}
                                </tbody>
                            </thead>
                        </table>
                        <div class="row">
                            <div class='col-md-1'>
                                <button class="btn btn-primary"><span>Export</span></button>
                            </div>
                            <div class="transaction-control-group col-md-9"></div>
                            <div>
                                <div class='col-md-1'>
                                <!-- <div class='col-md-1'> -->
                                    <input type="hidden" id="hidden_row" value="0"></input>
                                    <select id="pagination_value"  class="form-control">
                                        <option value="20">20</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                        <option value="250">250</option>
                                    </select>
                                </div>
                                <div class='col-md-1'>
                                    <ul class="pagination" style="margin:0px;">
                                        <li class="page-item disabled" id='previousPage'>
                                        <a class="page-link" href="javascript:getPrevious();" tabindex="-1"><i class='fas fa-caret-left'></i></a>
                                        </li>
                                        {% if isLastPage is True %}
                                        <li class="page-item disabled" id='nextPage'><a class="page-link" href="javascript:getNext();"><i class='fas fa-caret-right'></i></a></li>
                                        {% else %}
                                        <li class="page-item" id='nextPage'><a class="page-link" href="javascript:getNext();"><i class='fas fa-caret-right'></i></a></li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        
        <!-- payment and member limitations section -->
        <div class="row" style="margin-top:20px; margin-left:3px;">
                <div class="payment-detail-rectangle col-md-5">  
                    <div class="half-title-block" style="background-color: #4f7c1a;">
                        <span class="detail-title">Payment</span>
                        <div style="margin: 30px 15px 30px 15px;">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="payment-block-title">PAYMENT PERMISSION LEVEL</div>
                                    <div id="payment-block">
                                       <div id="payment-text">Normal</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="payment-block-title">BANK ACCOUNT DETAILS</div>
                                    <div class="col-md-6" style="padding-left:0px;">
                                        <div class="payment-info">Bank name</div>
                                        <div class="payment-info">Account number</div>
                                        <div class="payment-info">Sort code</div>
                                    </div>
                                    <div class="col-md-6" style="padding-left:0px;">
                                        <div class="payment-text">Bank name</div>
                                        <div class="payment-text">Account number</div>
                                        <div class="payment-text">Sort code</div>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="margin-left:0px;">
                                <div class="payment-deposit">DEPOSIT METHODS</div>
                                <div class="label">
                                    METHOD
                                </div>
                                <div class="deposit-table-first">
                                    <div class="deposit-text">Bank card</div>
                                </div>
                                <div class="deposit-table-first" style="background-color: #ffffff">
                                    <div class="deposit-text">Paypal</div>
                                </div>
                                <div class="deposit-table-first">
                                    <div class="deposit-text">Netteller</div>
                                </div>
                                <div class="deposit-table-first" style="background-color: #ffffff">
                                    <div class="deposit-text">Bank transfer</div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="member-limitations-rectangle col-md-5">  
                    <div class="half-title-block" style="background-color: #8b572a;">
                        <span class="detail-title">Member limitations</span>
                    </div>
                </div>
            </div>



        <div>&nbsp;</div>
        <div class="row">
            <div class="col-md-11"></div>
            <div class="col-md-1">
                <a class="btn btn-primary" role="button" id="back-btn" href="{% url 'xadmin:user_list' %}">BACK</a>
            </div>
        </div>

        
    <!-- </div> -->

<!-- <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/css/bootstrap.css" rel="stylesheet"/> -->
<script type='text/javascript' src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
<!-- <link href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/css/bootstrap-datetimepicker.css" rel="stylesheet"/> -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/css/datepicker.css" rel="stylesheet" type="text/css" />
<link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.7.0/css/all.css' integrity='sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ' crossorigin='anonymous'>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.js"></script>
<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/js/bootstrap-datetimepicker.min.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

<script>

// $('#datetimepicker1').datetimepicker();

$(document).ready(function() {
    var csrftoken = $.cookie("csrftoken");
    // console.log(csrftoken);

    var previousURL = document.referrer;

    $("#back-btn").attr("href", previousURL);

    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }

    chooseFile = function (event) {
        // $("#fileInput").click();
        // let val = $("#fileInput").val();
        // console.log(val);
        // $('image').attr(src) = val;
        var input = event.target;
        // $('#user-photo-img').css('display', 'none');

        var reader = new FileReader();
        reader.onload = function(){
            var dataURL = reader.result;
            var output = document.getElementById('user-photo-img');
            output.src = dataURL;
            $('#hidden_user_id_url').attr('value', dataURL);
        };
        reader.readAsDataURL(input.files[0]);
        
        $('#user-photo-img').css('max-width', '250px');
        $('#user-photo-img').css('max-height', '200px');
   }

   clickUploadImg = function () {
        $('#hidden_input_img').click();
   }

   clearImg = function() {
        $('#user-photo-img').attr('src', 'https://www.imagemet.com/wp-content/uploads/2016/12/placeholder.png');
   }

    $.ajaxSetup({
        beforeSend: function (xhr, settings) {
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
        }
    });

    $("#member_id").prop("readonly", true);

    $('#username').blur(function() {                   
        if( !$(this).val().trim() ) {    
            $('#errorMessage').text('Username cannot be empty'); 
            $('#errorMessage').css('color', 'red'); 
            $('#username').focus();
            $('#submitButton').attr('disabled', 'disabled');
        } else {
            $('#submitButton').removeAttr('disabled');
            $('#errorMessage').text(''); 
        }
        
    });

    $('#email').blur(function() {                   
        if( !$(this).val().trim() ) {    
            $('#errorMessage').text('Email cannot be empty'); 
            $('#errorMessage').css('color', 'red'); 
            // $('#email').focus();
            $('#submitButton').attr('disabled', 'disabled');
        } else {
            $('#submitButton').removeAttr('disabled');
            $('#errorMessage').text('');
        }
        
    });

    $('#phone').blur(function() {                   
        if( !$(this).val().trim() ) {    
            $('#errorMessage').text('Phone cannot be empty'); 
            $('#errorMessage').css('color', 'red'); 
            // $('#phone').focus();
            $('#submitButton').attr('disabled', 'disabled');
        } else {
            $('#submitButton').removeAttr('disabled');
            $('#errorMessage').text('');
        }
    });

    $('#zoom-btn').on('click', function () {
        var image = $('#user-photo-id').attr('src');
        $('#myModal').on('show.bs.modal', function () {
            $(".showimage").attr("src", image);
        });
    });

    $(function () {
        $('#transaction_time_from').datepicker({ 
        autoclose: true, 
        todayHighlight: true,
        endDate: new Date()
        }).val('');
        $('#transaction_time_to').datepicker({ 
        autoclose: true, 
        todayHighlight: true,
        endDate: new Date()
        }).val('');
    });
    
    var user_id = $('#hidden_user_id').val();
    // console.log(user_id)

    $('#transaction_time_submit').click( function(e) {
        e.preventDefault();

        $('#hidden_row').val(0);
        getTransactions(0);
    });

    $('#transaction_category_select').change(function() { 
        $('#hidden_row').val(0);
        getTransactions(0);
    });

    $('#pagination_value').on('change', function() {
        $('#hidden_row').val(0);
        getTransactions(0);
    });


    $('#post-btn').click( function(e) {
        e.preventDefault();
        var message = $('#notes-input').val();
        updateNote(message);
    });


    $('#activity-select').change(function() {
        var activity = $('#activity-select').val();
        getActivityfilter(activity);
    });

    getNext = function() {
        if ($('#nextPage').hasClass('disabled')) {
            return;
        }
        var pageSize = $("#pagination_value").val();
        var oldFromItem = $('#hidden_row').val();
        var newFromItem = Number(oldFromItem) + Number(pageSize);
        $('#hidden_row').val(newFromItem);
        getTransactions(newFromItem);
       
    }

    getPrevious = function () {
        if ($('#previousPage').hasClass('disabled')) {
            return;
        }
        var pageSize = $('#pagination_value').val();
        var oldFromItem = $('#hidden_row').val();
        var newFromItem = Number(oldFromItem) - Number(pageSize);
        $('#hidden_row').val(newFromItem);
        getTransactions(newFromItem);
    }

    showInitialTransaction = function (username, trans, type) {
        trans = JSON.parse(trans.replace(/'/g, '"'));
        showTransaction(username, trans, type);
    }

    showTransaction = function (username, trans, type) {
        // var trans = JSON.parse(trans.replace(/'/g, '"'));
        // console.log(JSON.parse(trans));
        var time = moment(trans.time).format('MMMM, D, YYYY h:mm a');
        if (type === "deposit") {

            $("#deposit-detail").empty();
            var content = "";
            content += "<p>" + username + "</p>";
            content += "<p>" + trans.transactionId + "</p>";
            content += "<p>" + time + "</p>";
            content += "<p>" + time + "</p>";
            content += "<p>/</p>";
            content += "<p>" + trans.channel + "</p><p>" + trans.method + "</p>";
            content += "<p>/</p>";
            content += "<p>" + trans.amount + "</p>";
            content += "<p>" + trans.amount + "</p>";
            content += "<p>" + trans.status + "</p>";
            $("#deposit-detail").append(content);

        } else if (type == "withdraw") {

            $("#withdraw-detail").empty();
            var content = "";
            content += "<p>" + username + "</p>";
            content += "<p>" + trans.transactionId + "</p>";
            content += "<p>" + time + "</p>";
            content += "<p>" + time + "</p>";
            content += "<p>/</p>";
            content += "<p>" + trans.channel + "</p><p>" + trans.method + "</p>";
            content += "<p>/</p>";
            content += "<p>" + trans.amount + "</p>";
            content += "<p>" + trans.amount + "</p>";
            content += "<p>" + trans.status + "</p>";
            $("#withdraw-detail").append(content);

        }
        
    }


    var ctx = document.getElementById('deposit-withdraw-chart');
    var chart = new Chart(ctx, {
        // The type of chart we want to create
        type: 'bar',

        // The data for our dataset
        data: {
            labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
            datasets: [{
                label: 'My First dataset',
                backgroundColor: 'rgb(255, 99, 132)',
                borderColor: 'rgb(255, 99, 132)',
                data: [0, 10, 5, 2, 20, 30, 45]
            }]
        },
        // Configuration options go here
        options: {}
    });
});

function updateNote(message) {

    var user_id = $('#hidden_user_id').val();
    var admin_user = "{{ user.username }}";
    $.ajax({
        type:'POST',
        url:"{% url 'xadmin:user_detail' %}",
        data:{ 
            'type': 'update_message',
            'user_id': user_id,
            'admin_user': admin_user,
            'message': message,
        },
        success:function(data) {
            location.reload();
        }
    });
}

function getActivityfilter(activity) {

    var user_id = $('#hidden_user_id').val();
    $.ajax({
        type:'POST',
        url:"{% url 'xadmin:user_detail' %}",
        data:{ 
            'type': 'activity_filter',
            'user_id': user_id,
            'activity_type': activity
        },
        success:function(data) {
            // console.log(data);
            getActivityData(data);
        }
    });
    

}

function getActivityData(data) {

    $("#select-filter").empty();
    content = "";
    for(var i = 0; i < data.length; i++) {
        content += '<div class="note-author">' + data[i].adminUser + '</div>';
        content += '<div class="note-block">' + data[i].message + '</div>';
    }
    $("#select-filter").append(content);
}

function getTransactions(fromItem) {

    var user_id = $('#hidden_user_id').val();

    var time_from = $('#transaction_time_from_input').val();
    // console.log(time_from);
    time_from = moment(time_from).format('YYYY-MM-DD HH:mm');
    // time_from = time_from.format('YYYY-MM-DD HH:mm');
    var time_to = $('#transaction_time_to_input').val();
    // console.log(time_to);
    time_to = moment(time_to).format('YYYY-MM-DD HH:mm');

    var category = $('#transaction_category_select').val();

    var pageSize = $("#pagination_value").val();

    $.ajax({
        type:'POST',
        url:"{% url 'xadmin:user_detail' %}",
        data:{ 
            'type': 'get_user_transactions',
            'user_id': user_id,
            'from': time_from,
            'to': time_to,
            'fromItem': fromItem,
            'pageSize': pageSize,
            'transaction_category': category
        },
        success:function(data) {

            // console.log(data);
            getTransData(data);
        }
    });
}

function getTransData(data) {

    if (data['isLastPage']) {
        $('#nextPage').addClass('disabled');
    } else {
        $('#nextPage').removeClass('disabled');
    }
    if (data['isFirstPage']) {
        $('#previousPage').addClass('disabled');
    } else {
        $('#previousPage').removeClass('disabled');
    }
    var data = data['transactions'];
    $("#transaction_tbody").empty();
    for (var i = 0; i < data.length; i++) {
        var fields = data[i].fields;
        var time = moment(fields.request_time).format('MMMM, D, YYYY h:mm a');
        // time = time.format();
        var content = '';
        content += '<tr>';
        content += '<td scope="row">' + (i+1) + '</td>';
        if (fields.transaction_type == 0) {
            content +=  '<td>Deposit</td>';
            content +=  '<td>Deposit</td>';
        } else if (fields.transaction_type == 1) {
            content +=  '<td>Withdraw</td>';
            content +=  '<td>Withdraw</td>';
        }

        if (fields.product == 0) {
            content += '<td>Sports</td>';
        } else if (fields.product == 1) {
            content += '<td>Games</td>';
        } else if (fields.product == 2) {
            content += '<td>Live Casino</td>';
        } else if (fields.product == 3) {
            content += '<td>Financial</td>';
        } else if (fields.product == 4) {
            content += '<td>General</td>';
        }
        content += '<td>' + data[i].pk + '</td>';
        if (fields.transfer_to) {
            content += '<td>' + fields.transfer_to + '</td>';
        } else {
            content += '<td>None</td>';
        }

        if (fields.currency == 0) {
            content += '<td>CNY</td>';
        }
        // content += '<td>' + fields.currency + '</td>';
        content += '<td>' + time + '</td>';
        content += '<td>' + fields.amount + '</td>';
        content += '<td>' + fields.amount + '</td>';
        content += '<td>' + fields.status + '</td>';
        var trans = JSON.stringify(fields);
        if (fields.transaction_type == 0) {
                content += '<td><button type="button" onclick=\'showTransaction(\"{{ customuser.username }}\", ' + trans + ', \"deposit\")\' class="btn btn-primary" data-toggle="modal" data-target="#trans_deposit_detail"><span class="glyphicon glyphicon-search"></span></button></td>';
            } else if (fields.transaction_type == 1) {
                content += '<td><button type="button" onclick=\'showTransaction(\"{{ customuser.username }}\", ' + trans + ', \"withdraw\")\' class="btn btn-primary" data-toggle="modal" data-target="#trans_withdrawal_detail"><span class="glyphicon glyphicon-search"></span></button></td>';
            } else if (fields.transaction_type == 2) { 
                content += '<td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#trans_bet_placed_detail"><span class="glyphicon glyphicon-search"></span></button></td>';
            } else if (fields.transaction_type == 3) {
                content += '<td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#trans_bet_settled_detail"><span class="glyphicon glyphicon-search"></span></button></td>';
            } else if (fields.transaction_type == 4) {
                content += '<td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#trans_trans_in_detail"><span class="glyphicon glyphicon-search"></span></button></td>';
            } else if (fields.transaction_type == 5) {
                content += '<td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#trans_trans_out_detail"><span class="glyphicon glyphicon-search"></span></button></td>';
            } else if (fields.transaction_type == 6) {
                content += '<td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#trans_bonus_detail"><span class="glyphicon glyphicon-search"></span></button></td>';
            } else if (fields.transaction_tyep == 7) {
                content += '<td><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#trans_adjustment_detail"><span class="glyphicon glyphicon-search"></span></button></td>';
            }
        content += '</tr>';
        $("#transaction_tbody").append(content);
    }
}

</script>


{% endblock %}
