<div class="modal-content">
    <div class="modal-header">
        Edit payment method
    </div>
    <div class="modal-body">
        <div id="psp-details" style="columns: 2; background-color: #f3f3f3">
            <p class="text-label">Method</p>
            <p class="text-label">Type</p>
            <p class="text-label">Channel</p>
            <p class="text-label">Market</p>
            <p class="text-label">Supplier</p>
            <p class="text-value" id="psp-method">VISA</p>
            <p class="text-value" id="psp-type">Deposit</p>
            <p class="text-value" id="psp-channel"></p>
            <p class="text-value" id="psp-market"></p>
            <p class="text-value" id="psp-supplier"></p>
        </div>
        <div id="radio-buttons-labels">
            <p style="display: inline-block;" class="text-label">Payment Method Status</p>
            <input id="status-active" style="display: inline-block;" type="radio" name="status" value="active" checked="checked" disabled="true">Active</input>
            <input id="status-disabled" style="display: inline-block;" type="radio" name="status" value="disabled" disabled="true">Disabled</input>
            <br>
            <p style="display: inline-block;" class="text-label">Risk Review Required</p>
            <input style="display: inline-block;" type="radio" name="risk" value="yes" checked="checked" disabled="true">Yes</input>
            <input style="display: inline-block;" type="radio" name="risk" value="no" disabled="true">No</input>
            <br>
            <p style="display: inline-block;" class="text-label">Settlement Confirmation Required</p>
            <input id="settlement-yes" style="display: inline-block;" type="radio" name="settlement" value="yes" disabled="true" checked="checked">Yes</input>
            <input id="settlement-no" style="display: inline-block;" type="radio" name="settlement" value="no" disabled="true">No</input>
            <br>
            <p style="display: inline-block;" class="text-label">Result override allowed</p>
            <input id="override-yes" style="display: inline-block;" type="radio" name="override" value="yes" disabled="true" checked="checked">Yes</input>
            <input id="override-no" style="display: inline-block;" type="radio" name="override" value="no" disabled="true">No</input>
            <br>
        </div>
        <hr style="width: 100%; color: #bdbdbd">
        <div id="downtime">
            <p style="font-weight: bold; font-family: Helvetica; font-size: 15px;">SCHEDULED DOWNTIME</p>
            <p>The payment method will be disabled during this period.</p>

            <div id="all-dt">
                <div class="freq-inputs">
                    <select id="downtime-freq" class="freq-input-inner">
                        <option value="once">Once</option>
                        <option value="daily">Daily</option>
                        <option value="monthly" selected="true">Monthly</option>
                    </select>
                    <select id="day-select" style="display: hidden;" class="freq-input-inner">
                        {% for i in days %}
                            <option value="{{i}}">{{i}}</option>
                        {% endfor %}
                    </select>
                    <div class='input-group date' id='downtime_From'>
                        <span class="input-group-addon">
                            From
                        </span>
                        <input type='text' class="form-control" id='dt-from'/>
                    </div>
                    <div class='input-group date' id='downtime_To'>
                        <span class="input-group-addon">
                            To
                        </span>
                        <input type='text' class="form-control" id='dt-to'/>
                    </div>
                    <button id="add-freq">+</button>
                </div>
            </div>
        </div>
        <hr style="width: 100%; color: #bdbdbd">
        <div id="payment-settings">
            <p style="font-weight: bold; font-family: Helvetica; font-size: 15px;">PAYMENT SETTINGS</p>
            <div id="min-max" class="modal-section">
                <div class="row">
                    <label for='min-dep'>MINIMUM DEPOSIT</label>
                    <div class='input-group date' id='min-deposit'>
                        <input type='text' class="form-control" id='min-dep' disabled>
                        <span class="input-group-addon">
                            $
                        </span>
                    </div>
                </div>
                <div class="row">
                    <label for='max-dep'>MAXIMUM DEPOSIT</label>
                    <div class='input-group date' id='max-deposit'>
                        <input type='text' class="form-control" id='max-dep' disabled>
                        <span class="input-group-addon">
                            $
                        </span>
                    </div>
                </div>
            </div>
            <div id="txn-fee" class="modal-section">
                <div class="row">
                    <label for='min-dep'>TRANSACTION FEE</label>
                    <div class='input-group date' id='txn-fee'>
                        <input type='text' class="form-control" id='txn-fee-input' disabled>
                        <span class="input-group-addon">
                            $
                        </span>
                    </div>
                </div>
                <div class="row">
                    <label for='max-dep'>TRANSACTION % FEE</label>
                    <div class='input-group date' id='txn-fee-per'>
                        <input type='text' class="form-control" id='txn-fee-per-input' value="1.00" disabled>
                        <span class="input-group-addon">
                            %
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <hr style="width: 100%; color: #bdbdbd">
        <div id="access-settings">
            <p style="font-weight: bold; font-family: Helvetica; font-size: 15px;">ACCESS SETTINGS</p>
            <p>To have access to this payment method, the player needs the following conditions to be met.</p>
            <div id="verifications">
                
                <input id="id-verify" type="checkbox" checked="checked" disabled>
                <label for="id-verify">ID verified</label>
                <br>
                
                <input id="email-verify" type="checkbox" checked="checked" disabled>
                <label for="email-verify">Email verified</label>
                <br>
                
                <input id="phone-verify" type="checkbox" checked="checked" disabled>
                <label for="phone-verify">Phone verified</label>
                <br>
            </div>
            <div class="allowance" style="padding-top: 10px">
            <p style="font-weight: bold; font-size: 12px;">ALLOWED PLAYER SEGMENT</p>
                <div class="row">
                    {% for x in player_segments %}
                        {% if x == "ALL" %}
                        <input type="checkbox" class="cbox" checked="checked" id="segment-{{x}}" disabled>
                        <label for="segment-{{x}}">{{x}}</label>
                        {% else %}
                        <input type="checkbox" class="cbox" disabled>
                        <label for="segment-{{x}}">{{x}}</label>
                        {% endif %}
                    {% endfor %}
                </div>
            <p style="font-weight: bold; font-size: 12px;">ALLOWED RISK LEVEL</p>
                <div class="row">
                    {% for x in risk_levels %}
                        {% if x == "ALL" %}
                        <input type="checkbox" class="cbox" checked="checked" id="risk-{{x}}" disabled>
                        <label for="risk-{{x}}">{{x}}</label>
                        {% else %}
                        <input type="checkbox" class="cbox" disabled>
                        <label for="risk-{{x}}">{{x}}</label>
                        {% endif %}
                    {% endfor %}
                </div>
            <p style="font-weight: bold; font-size: 12px;">ALLOWED STATUS</p>
                <div class="row">
                    {% for x in statuses %}
                        {% if x == "ALL" %}
                        <input type="checkbox" class="cbox" checked="checked" id="status-{{x}}" disabled>
                        <label for="status-{{x}}">{{x}}</label>
                        {% else %}
                        <input type="checkbox" class="cbox" disabled>
                        <label for="status-{{x}}">{{x}}</label>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        <hr style="width: 100%; color: #bdbdbd">        
        <div class="white-blacklist">
            <p style="font-weight: bold; font-family: Helvetica; font-size: 15px;">BLACK & WHITE LISTS</p>
            <p>These lists override all other access permissions. A player in the blacklist has no access to this payment method. A player in the whitelist has access regardless of general settings.</p>
            <div class="white-blacklist-inputs" style="display: flex; justify-content: space-evenly; margin-bottom: 20px;">
                <div class="row">
                    <label for="whitelist-input">
                        WHITELISTED PLAYERS
                    </label>
                    <div class='input-group date' id='white-list'>
                        <input type='text' class="form-control" id='whitelist-input' disabled>
                        <span id='edit-whitelist-btn' class="input-group-addon" style="color: whitesmoke; background-color:#428bca;">
                            Edit
                        </span>
                    </div>
                </div>
                <div class="row">
                    <label for="whitelist-input">
                        BLACKLISTED PLAYERS
                    </label>
                    <div class='input-group date' id='black-list'>
                        <input type='text' class="form-control" id='blacklist-input' disabled>
                        <span id='edit-blacklist-btn' class="input-group-addon" style="color: whitesmoke; background-color:#428bca;">
                            Edit
                        </span>
                    </div>
                </div>
            </div>
        </div>  
        <div class="form-group">
            <div id="psp-notes">
                <label for="withdraw_notes" style="margin-left: 10px">NOTES</label>
                <textarea type='text' id='notes' class="form-control" name="psp-notes"
                    style="width: 80%; height: 120px;"
                    placeholder="Please provide a brief explanation for updating the payment method"></textarea>
            </div>
            <div id="psp-config-buttons" style="margin-top: 13px">
                <button type="button" class="btn btn-primary">Save</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- <link rel="stylesheet" type="text/css" href="/jquery.datetimepicker.css"> -->
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.css">

<!-- <script src="/build/jquery.datetimepicker.full.min.js"></script> -->
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.full.min.js"></script>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>

<script>
    let logic = function() {
        let freqValue = $('#downtime-freq').children("option:selected").val();
        if (freqValue != "once") {
            this.setOptions({
                datepicker: false,
                format: 'g:ia',
                validateOnBlur: false
            });
        }
        else {
            this.setOptions({
                datepicker: true,
                startDate:new Date(),
                format:'Y/m/d g:ia',
                validateOnBlur: false
            })
        }
    }

    function toggleDowntime() {
        $('#downtime-freq').on('change', (event) => {
            let frequency = $('#downtime-freq').children("option:selected").val();
            if (frequency == "monthly") document.getElementById('day-select').style.display = 'block';
            else document.getElementById('day-select').style.display = 'none';
        });
    }
    $(document).ready(function () {
        toggleDowntime();
        let frequency = $('#downtime-freq').children("option:selected").val();

        if (frequency == "monthly")  document.getElementById('day-select').style.display = 'block';
        else document.getElementById('day-select').style.display = 'none';

        $('#dt-from').datetimepicker({
            onShow: logic,
            validateOnBlur: false

        });
        $('#dt-to').datetimepicker({
            onShow: logic,
            validateOnBlur: false

        });

        
        $('#add-freq').on('click', function(event) {
            let frequency = $('#downtime-freq').children("option:selected").val();
            
            $.ajax({
                type: 'POST',
                url: '{% url "xadmin:sched_downtime" %}',
                data: {
                    'pk': $(this).data('pk'),
                    'from': $('#dt-from').val(),
                    'to': $('#dt-to').val(),
                    'psp_type': $(this).data('type'),
                    'frequency': frequency,
                    ...(frequency == 'monthly' && {'date': $('#day-select').children("option:selected").val()})
                },
                success: (data) => {
                    if (data.success) {
                        alert("Downtime added");
                        window.location.reload();
                    }
                    else {
                        alert("Missing info");
                    }
                },
                error: (data) => {
                    alert("Error: " + (JSON.stringify(data)));
                }
            })
        });
    })
</script>